<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: https:; frame-src https:;">

    <title>Syriabest | سوريا بست - مشاهدة أحدث الأفلام والمسلسلات</title>
    <meta name="description" content="موقع سوريا بست Syriabest لمشاهدة أحدث الأفلام والمسلسلات العربية والأجنبية، سلاسل أفلام مارفل، أفلام الرعب، والأكشن بجودة عالية وسيرفرات سريعة.">
    <meta name="keywords" content="Syriabest, سوريا بست, مشاهدة افلام, مسلسلات حصريا, افلام مارفل, افلام رعب, افلام اكشن, افلام 2026, مصطفى بربور">
    <meta name="author" content="Mostafa Barbour">
    <meta name="robots" content="index, follow">
    
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <meta property="og:title" content="Syriabest | عالم الترفيه بين يديك">
    <meta property="og:description" content="استمتع بمشاهدة أحدث الأفلام والمسلسلات على Syriabest بأعلى جودة.">
    <meta property="og:url" content="https://syriabest.com">
    <meta property="og:type" content="website">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Syriabest",
      "url": "https://syriabest.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://syriabest.com/?search={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --main-red: #e50914;
            --dark-bg: #141414;
            --card-bg: #1f1f1f;
            --gray-text: #a3a3a3;
            --overlay-bg: rgba(0, 0, 0, 0.9);
            --glass-bg: rgba(20, 20, 20, 0.75);
        }

        /* حماية: منع نسخ المحتوى */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            background-color: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- الهيدر (Navbar) --- */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 2000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            transition: 0.4s;
        }

        header.scrolled {
            background-color: #000;
            padding: 10px 5%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .logo {
            color: var(--main-red);
            font-size: clamp(24px, 5vw, 32px);
            font-weight: 900;
            text-decoration: none;
            text-transform: uppercase;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        .nav-links a {
            color: #e5e5e5;
            text-decoration: none;
            font-size: 15px;
            font-weight: 600;
            transition: 0.3s;
        }

        .nav-links a:hover { color: var(--main-red); }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            color: #fff;
            padding: 5px 10px;
            border-radius: 20px;
            outline: none;
            width: 150px;
            font-size: 13px;
            transition: 0.3s;
        }
        .search-input:focus { width: 200px; border-color: var(--main-red); }

        .btn-auth {
            background-color: var(--main-red);
            color: #fff;
            padding: 7px 18px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 14px;
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }

        .mobile-menu-btn {
            display: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* --- قسم الهيرو (Hero) مع إضافة العلامة المائية المائلة --- */
        .hero {
            height: 85vh;
            width: 100%;
            position: relative; /* ضروري لتحديد موقع الكلمة المائلة */
            background: linear-gradient(to top, var(--dark-bg) 10%, transparent 40%),
                        linear-gradient(to left, rgba(0,0,0,0.7), transparent),
                        url('hero-bg.jpg');
            background-size: cover;
            background-position: center center;
            display: flex;
            align-items: center;
            padding: 0 5%;
            overflow: hidden; /* لمنع الكلمة الكبيرة من عمل سكرول عرضي */
        }

        /* تصميم الكلمة المائلة الاحترافية */
        .hero-watermark {
            position: absolute;
            right: -5%;
            top: 50%;
            transform: translateY(-50%) rotate(-15deg);
            font-size: clamp(100px, 20vw, 250px);
            font-weight: 900;
            color: var(--main-red);
            opacity: 0.12; /* شفافة جداً لكي لا تعيق الرؤية */
            pointer-events: none; /* لكي لا يتمكن المستخدم من الضغط عليها */
            z-index: 1; /* خلف المحتوى الأساسي وأمام الخلفية */
            font-style: italic;
            text-transform: uppercase;
            white-space: nowrap;
            filter: blur(1px);
        }

        .hero-content {
            position: relative;
            z-index: 10; /* فوق العلامة المائية */
            max-width: 700px;
            margin-top: 50px;
        }

        .hero-content h1 {
            font-size: clamp(32px, 8vw, 64px);
            margin-bottom: 15px;
            line-height: 1.1;
        }

        .hero-content p {
            font-size: clamp(14px, 3vw, 19px);
            color: #ddd;
            margin-bottom: 25px;
            max-width: 550px;
        }

        .series-banner {
            width: 90%;
            margin: 40px auto;
            background: linear-gradient(45deg, #800000, #e50914, #800000);
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(229, 9, 20, 0.3);
            border: 2px solid rgba(255,255,255,0.1);
        }

        .series-banner h2 {
            font-size: clamp(22px, 5vw, 36px);
            font-weight: 800;
            color: #fff;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            letter-spacing: 1px;
        }

        .hero-btns {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-hero {
            padding: 12px 28px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }

        .btn-play { background-color: #fff; color: #000; }
        .btn-play:hover { background-color: #bfbfbf; }
        .btn-more { background-color: rgba(109, 109, 110, 0.7); color: #fff; }
        .btn-more:hover { background-color: rgba(109, 109, 110, 0.5); }

        /* --- صفوف الأفلام --- */
        .content-area {
            margin-top: -80px;
            padding-bottom: 50px;
        }

        .row {
            padding: 20px 5%;
        }

        .row-title {
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .row-title a {
            font-size: 13px;
            color: var(--main-red);
            text-decoration: none;
        }

        .movie-slider {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 15px 0;
            scrollbar-width: none;
        }

        .movie-slider::-webkit-scrollbar { display: none; }

        .movie-card {
            min-width: clamp(160px, 25vw, 240px);
            aspect-ratio: 2/3;
            background-color: var(--card-bg);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .movie-card:hover {
            transform: scale(1.05);
            z-index: 100;
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
            border: 2px solid var(--main-red);
        }

        .movie-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            opacity: 0;
            transition: 0.3s;
            gap: 5px;
        }
        .card-overlay i { font-size: 40px; color: #fff; }
        .card-overlay i.fa-lock { color: #ffcc00; }
        .card-overlay span { font-size: 14px; font-weight: bold; padding: 0 10px; text-align: center; }

        .movie-card:hover .card-overlay { opacity: 1; }

        /* --- نظام المفضلة الجديد --- */
        .fav-btn-card {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            z-index: 110;
            transition: 0.3s;
        }
        .fav-btn-card.active { color: var(--main-red); }
        .fav-btn-card:hover { transform: scale(1.2); background: #000; }

        .fav-status-btn {
            background: #333;
            color: #fff;
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .fav-status-btn.active { background: var(--main-red); }

        #searchOverlay {
            display: none; position: fixed; inset: 0; background: var(--dark-bg);
            z-index: 4000; padding: 100px 5% 50px; overflow-y: auto;
        }
        .verified-badge { color: #1da1f2; margin-right: 5px; font-size: 0.9em; }
        
        #accountSection {
            display: none; position: fixed; inset: 0; background: var(--dark-bg);
            z-index: 3500; padding: 60px 5%; overflow-y: auto;
        }
        .account-box {
            background: var(--card-bg); max-width: 800px; margin: 0 auto;
            padding: 40px; border-radius: 15px; border: 1px solid #333;
        }

        .rating-area { padding: 50px 5%; background: #000; text-align: center; border-top: 1px solid #222; }
        .rating-area textarea { 
            width: 100%; max-width: 600px; background: #222; border: 1px solid #444; 
            color: #fff; padding: 15px; border-radius: 8px; margin: 20px 0; font-family: inherit;
        }

        .video-popup {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 5000;
            justify-content: flex-start;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .video-wrapper {
            width: 90%;
            max-width: 1000px;
            position: relative;
            background: #000;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            border: 1px solid #333;
        }

        .server-bar {
            width: 90%;
            max-width: 1000px;
            background: #222;
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--main-red);
            border-radius: 8px 8px 0 0;
        }

        .server-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            transition: 0.3s;
        }

        .server-btn.active { background: var(--main-red); }
        .server-btn:hover { background: #444; }

        .video-wrapper iframe {
            width: 100%;
            aspect-ratio: 16/9;
        }

        /* --- تحسينات المسلسلات --- */
        .series-controls {
            width: 90%;
            max-width: 1000px;
            background: #1a1a1a;
            margin-top: 15px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .control-group { margin-bottom: 20px; }
        .control-group h4 { color: var(--main-red); margin-bottom: 10px; font-size: 16px; border-right: 3px solid var(--main-red); padding-right: 10px; }
        
        .btn-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ep-btn {
            background: #262626;
            color: #fff;
            border: 1px solid #444;
            padding: 6px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }

        .ep-btn:hover { background: #333; }
        .ep-btn.active { background: var(--main-red); border-color: var(--main-red); }

        .close-video {
            align-self: flex-end;
            margin-bottom: 10px;
            margin-right: 5%;
            color: #fff;
            font-size: 30px;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        /* --- تصميم المودال المستقبلي 2026 --- */
        .auth-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-box {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(20px);
            width: 100%;
            max-width: 400px;
            padding: 40px;
            border-radius: 20px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            left: 20px;
            cursor: pointer;
            font-size: 20px;
            color: var(--gray-text);
        }

        .modal-box h2 { margin-bottom: 30px; text-align: center; font-weight: 800; letter-spacing: 1px; }

        .input-group { margin-bottom: 20px; }
        .input-group input {
            width: 100%;
            padding: 14px;
            background: rgba(255,255,255,0.05) !important;
            border: 2px solid transparent;
            border-radius: 12px;
            color: #fff;
            outline: none;
            transition: all 0.4s ease;
        }

        .input-group input:focus {
            border-color: var(--main-red);
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.3);
            background: rgba(255,255,255,0.1) !important;
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #e50914, #ff3d47) !important;
            color: #fff;
            border: none;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(229, 9, 20, 0.4);
        }

        /* سبينر التحميل */
        .loader {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            display: none;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .auth-footer-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray-text);
            cursor: pointer;
        }
        .auth-footer-link span { color: var(--main-red); font-weight: bold; }

        .hp-field { display: none !important; }

        @media (max-width: 768px) {
            header { padding: 15px 4%; }
            .nav-links { display: none; }
            .mobile-menu-btn { display: block; }
            .hero { height: 70vh; }
            .hero-content h1 { font-size: 38px; }
            .content-area { margin-top: -40px; }
            .nav-actions { gap: 8px; }
            .btn-auth { padding: 5px 12px; font-size: 12px; }
            .hero-watermark { font-size: 100px; right: -10%; } /* تحسين الحجم للموبايل */
        }

        #dmcaSection { display: none; padding: 100px 10%; background: var(--dark-bg); min-height: 80vh; }

        footer {
            padding: 60px 5% 30px;
            background: #000;
            text-align: center;
            border-top: 1px solid #222;
        }

        .footer-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 30px; margin-bottom: 40px; text-align: right;
        }

        .footer-grid ul { list-style: none; }
        .footer-grid li { margin-bottom: 10px; }
        .footer-grid a { color: var(--gray-text); text-decoration: none; font-size: 13px; }
        .footer-grid a:hover { text-decoration: underline; }

        .copyright { color: var(--gray-text); font-size: 12px; }

    </style>
</head>
<body oncontextmenu="return false;"> 
    
    <header id="mainNav">
        <div style="display: flex; align-items: center; gap: 20px;">
            <i class="fas fa-bars mobile-menu-btn" onclick="toggleMobileMenu()"></i>
            <a href="#" class="logo" onclick="location.reload()">Syriabest</a>
            <ul class="nav-links">
                <li><a href="#" onclick="location.reload()">الرئيسية</a></li>
                <li><a href="#row-foreign-series">مسلسلات</a></li>
                <li><a href="#row-action">أفلام</a></li>
                <li><a href="#" onclick="showDMCA()">DMCA / حقوق النشر</a></li>
            </ul>
        </div>
        
        <div class="nav-actions">
            <div class="search-container">
                <form onsubmit="handleSearch(event)">
                    <input type="text" id="globalSearch" class="search-input" placeholder="ابحث...">
                </form>
            </div>
            
            <button class="btn-auth" id="mainAuthBtn" onclick="toggleModal(true)">دخول</button>
        </div>
    </header>

    <div id="dmcaSection">
        <h1 style="color: var(--main-red); margin-bottom: 20px;">DMCA - سياسة حقوق النشر</h1>
        <p>موقع <strong>Syriabest</strong> هو محرك بحث للمحتوى الترفيهي. نحن لا نقوم برفع أو استضافة أي فيديوهات على خوادمنا الخاصة. جميع الروابط يتم جلبها من مواقع خارجية. إذا كنت صاحب حق وتريد إزالة محتوى، يرجى مراسلتنا لإزالته فوراً من قاعدة البيانات.</p>
        <button class="btn-auth" style="margin-top: 30px;" onclick="location.reload()">العودة للرئيسية</button>
    </div>

    <div id="searchOverlay">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="color: var(--main-red);">نتائج البحث</h2>
            <button class="btn-auth" onclick="closeSearch()">إغلاق</button>
        </div>
        <div id="searchResultsGrid" class="movie-slider" style="flex-wrap: wrap; gap: 20px;"></div>
    </div>

    <div id="accountSection">
        <div class="account-box">
            <h2 id="accDisplayName">اسم المستخدم</h2>
            <p style="margin: 15px 0; color: var(--gray-text);">مرحباً بك في لوحة تحكم حسابك</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <div style="background: #222; padding: 15px; border-radius: 8px; text-align: center;">
                    <span style="font-size: 13px; color: var(--gray-text);">أفلام شاهدتها</span><br>
                    <span id="watchStats" style="color: var(--main-red); font-weight: 800; font-size: 1.5em;">0</span>
                </div>
                <div style="background: #222; padding: 15px; border-radius: 8px; text-align: center;">
                    <span style="font-size: 13px; color: var(--gray-text);">في قائمتي</span><br>
                    <span id="favStats" style="color: #ffcc00; font-weight: 800; font-size: 1.5em;">0</span>
                </div>
            </div>

            <div style="text-align: right; margin-bottom: 30px;">
                <h3 style="border-right: 4px solid var(--main-red); padding-right: 10px; margin-bottom: 15px;">قائمتي المفضلة</h3>
                <div id="favoritesGrid" class="movie-slider" style="flex-wrap: wrap; gap: 10px; justify-content: center; min-height: 100px; background: #111; padding: 15px; border-radius: 10px;">
                    <p style="color: #666; font-size: 14px;">لا يوجد أفلام في قائمتك بعد.</p>
                </div>
            </div>

            <div style="max-width: 400px; margin: 0 auto;">
                <input type="text" id="editNameInput" placeholder="تغيير اسم العرض..." style="width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: #fff; border-radius: 5px; margin-bottom: 10px;">
                <button class="btn-auth" onclick="updateUsername()" style="width: 100%; margin-bottom: 10px;">حفظ الاسم الجديد</button>
                <button class="btn-auth" onclick="logoutUser()" style="width: 100%; background: #444;">تسجيل الخروج</button>
                <p onclick="closeAccount()" style="margin-top: 15px; cursor: pointer; text-decoration: underline; font-size: 14px;">العودة للرئيسية</p>
            </div>
        </div>
    </div>

    <main class="content-area" id="mainPageBody">
        <section class="hero">
            <div class="hero-watermark">Syriabest</div>

            <div class="hero-content">
                <h1>أفلامك المفضلة، <br>في مكان واحد.</h1>
                <p>استمتع بتجربة مشاهدة لا مثيل لها مع Syriabest. دقة عالية، سرعة في التحميل، وأحدث العروض الحصرية.</p>
                <div class="hero-btns">
                    <button class="btn-hero btn-play" onclick="document.getElementById('row-marvel').scrollIntoView()">
                        <i class="fas fa-th-list"></i> اكتشف المحتوى
                    </button>
                    <button class="btn-hero btn-more" onclick="alert('مرحباً بك في سوريا بست!')">
                        <i class="fas fa-info-circle"></i> معلومات
                    </button>
                </div>
            </div>
        </section>

        <div class="row">
            <div class="row-title">
                <span>عالم مارفل السينمائي (Marvel MCU)</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-marvel"></div>
        </div>

        <div class="row">
            <div class="row-title">
                <span>سلسلة Avengers</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-avengers"></div>
       </div>
        
        <div class="row">
            <div class="row-title">
                <span>سلسلة The transporter</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-thetransporter"></div>
    </div>
        
        <div class="row">
            <div class="row-title">
                <span>سلسلة Fast & Furious</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-fast"></div>
        </div>

        <div class="row">
            <div class="row-title">
                <span>أفلام الأكشن</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-action"></div>
        </div>
        
        <div class="row">
            <div class="row-title">
                <span>اكشن/كوميدي</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-actioncomedy"></div>
       </div>
        
        <div class="row">
            <div class="row-title">
                <span>أفلام الرعب (الأجزاء الكاملة)</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-horror"></div>
        </div>

        <div class="row">
            <div class="row-title">
                <span>إثارة وغموض </span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-thriller"></div>
        </div>

        <div class="series-banner">
            <h2>المسلسلات العربية والأجنبية المنوعة</h2>
        </div>

        <div class="row">
            <div class="row-title">
                <span>مسلسلات مصرية كوميدية</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-egypt-comedy"></div>
        </div>

        <div class="row">
            <div class="row-title">
                <span>مسلسلات أجنبية</span>
                <a href="#">مشاهدة الكل</a>
            </div>
            <div class="movie-slider" id="row-foreign-series"></div>
        </div>

        <section class="rating-area">
            <div class="rating-box">
                <h2 style="color: var(--main-red);">تقييمك يهمنا</h2>
                <p>أخبرنا عن تجربتك أو إذا واجهت أي مشاكل في الموقع</p>
                <textarea id="feedbackMsg" placeholder="اكتب ملاحظاتك هنا..."></textarea>
                <br>
                <button class="btn-auth" onclick="submitFeedback()">إرسال التقييم</button>
            </div>
        </section>
    </main>

    <div class="video-popup" id="videoPopup">
        <span class="close-video" onclick="closePlayer()">&times;</span>
        <div class="server-bar" id="serverList"></div>
        <div class="video-wrapper">
            <iframe id="mainPlayer" src="" frameborder="0" allowfullscreen></iframe>
        </div>
        
        <div id="seriesControls" class="series-controls">
            <div class="control-group">
                <h4>اختر الموسم:</h4>
                <div id="seasonContainer" class="btn-grid"></div>
            </div>
            <div class="control-group">
                <h4>اختر الحلقة:</h4>
                <div id="episodeContainer" class="btn-grid"></div>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; padding: 20px;">
            <h3 id="movieTitleDisplay" style="color: var(--main-red); font-weight: 800; text-align: center;"></h3>
            <button id="playerFavBtn" class="fav-status-btn" onclick="toggleFavoriteFromPlayer()">
                <i class="fas fa-plus"></i> إضافة لقائمتي
            </button>
        </div>
    </div>

    <div class="auth-modal" id="authModal">
        <div class="modal-box" id="loginBox">
            <i class="fas fa-times close-modal" onclick="toggleModal(false)"></i>
            <h2>تسجيل الدخول</h2>
            <form onsubmit="handleAuth(event)">
                <div class="input-group">
                    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" required>
                </div>
                <div class="input-group">
                    <input type="password" id="loginPass" placeholder="كلمة المرور" required>
                </div>
                <button type="submit" class="btn-submit">
                    <span>دخول</span>
                </button>
            </form>
            <p class="auth-footer-link" onclick="switchAuthMode('register')">ليس لديك حساب؟ <span>إنشاء حساب</span></p>
        </div>

        <div class="modal-box" id="registerBox" style="display:none;">
            <i class="fas fa-times close-modal" onclick="toggleModal(false)"></i>
            <h2>إنشاء حساب جديد</h2>
            <form id="registerForm">
                <div class="input-group">
                    <input type="email" id="regEmail" placeholder="البريد الإلكتروني" required>
                </div>
                <input type="text" name="bot_check" class="hp-field">
                <div class="input-group">
                    <input type="password" id="regPass" placeholder="كلمة المرور" required>
                </div>
                <div class="input-group">
                    <input type="password" id="regPassConfirm" placeholder="تأكيد كلمة المرور" required>
                </div>
                <button type="button" id="regSubmitBtn" class="btn-submit g-recaptcha" 
                        data-sitekey="6Ld_Your_Site_Key" 
                        data-callback='onSubmit' 
                        data-action='submit'>
                    <span id="regBtnText">إنشاء الحساب</span>
                    <div class="loader" id="regLoader"></div>
                </button>
            </form>
            <p class="auth-footer-link" onclick="switchAuthMode('login')">لديك حساب؟ <span>تسجيل الدخول</span></p>
        </div>

        <div class="modal-box" id="verifyBox" style="display:none;">
            <i class="fas fa-times close-modal" onclick="toggleModal(false)"></i>
            <h2>تأكيد الحساب</h2>
            <p id="verifyInstruction" style="text-align:center; font-size:14px; margin-bottom:15px; color:var(--gray-text)">أدخل كود التحقق المرسل إلى إيميلك</p>
            <form onsubmit="handleVerification(event)">
                <div class="input-group">
                    <input type="text" id="verifyInput" placeholder="00000" maxlength="5" style="text-align:center; font-size:24px; letter-spacing:10px;" required>
                </div>
                <button type="submit" class="btn-submit">تحقق</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="footer-grid">
            <ul><li><a href="#">الأسئلة الشائعة</a></li><li><a href="#" onclick="showDMCA()">DMCA / حقوق النشر</a></li></ul>
            <ul><li><a href="#">مركز المساعدة</a></li><li><a href="#">الأحكام القانونية</a></li></ul>
            <ul><li><a href="#">الحساب</a></li><li><a href="#">فقط على Syriabest</a></li></ul>
        </div>
        <p class="copyright">© 2026 Syriabest. جميع الحقوق محفوظة لـ </p>
    </footer>

    <script>
        // --- حماية إضافية ---
        (function() {
            const shield = () => {
                const start = new Date();
                debugger;
                const end = new Date();
                if (end - start > 100) {
                    document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%;'>تم حجب الوصول: لا يسمح باستخدام أدوات المطورين!</h1>";
                }
            };
            setInterval(shield, 1000);
        })();

        window.addEventListener('keydown', (e) => {
            if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I") || (e.ctrlKey && e.key === "u")) {
                e.preventDefault();
                return false;
            }
        });

        let currentUser = JSON.parse(localStorage.getItem('sb_user')) || null;
        let watchCount = parseInt(localStorage.getItem('sb_watch_count')) || 0;
        let favorites = JSON.parse(localStorage.getItem('sb_favorites')) || [];
        let tempRegData = null;
        let currentOTP = ""; 

        function onSubmit(token) {
            document.getElementById('regBtnText').style.display = 'none';
            document.getElementById('regLoader').style.display = 'block';
            handleRegister();
        }

        const movieData = {
            marvel: [
                { id: "tt0371746", title: "Iron Man 1", img: "ironman1.JPG", type: "movie" },
                { id: "tt1228705", title: "Iron Man 2", img: "ironman2.JPG", type: "movie" },
                { id: "tt1300854", title: "Iron Man 3", img: "ironman3.JPG", type: "movie" },
                { id: "tt0800369", title: "Thor 1", img: "thor1.JPG", type: "movie" },
                { id: "tt1981115", title: "Thor: The Dark World", img: "thor2.JPG", type: "movie" },
                { id: "tt3501632", title: "Thor: Ragnarok", img: "thor3.JPG", type: "movie" },
                { id: "tt7097124", title: "Thor: Love and Thunder", img: "thor4.JPG", type: "movie" },
                { id: "tt0458339", title: "Captain America 1", img: "cap1.JPG", type: "movie" },
                { id: "tt1843866", title: "Captain America 2", img: "cap2.JPG", type: "movie" },
                { id: "tt2495708", title: "Captain America 3", img: "cap3.JPG", type: "movie" },
                { id: "tt2015381", title: "Guardians of the Galaxy 1", img: "gotg1.JPG", type: "movie" },
                { id: "tt3896198", title: "Guardians of the Galaxy 2", img: "gotg2.JPG", type: "movie" },
                { id: "tt6791342", title: "Guardians of the Galaxy 3", img: "gotg3.JPG", type: "movie" },
                { id: "tt14164730", title: "Black Panther: WF", img: "panther2.JPG", type: "movie" },
                { id: "tt5090568", title: "Spider-Man: Homecoming", img: "spiderman1.JPG", type: "movie" },
                { id: "tt6320628", title: "Spider-Man: Far From Home", img: "spiderman2.JPG", type: "movie" },
                { id: "tt10872600", title: "Spider-Man: No Way Home", img: "spiderman3.JPG", type: "movie" }
            ],
            avengers: [
                { id: "tt0848228", title: "The Avengers (2012)", img: "avengers1.JPG", type: "movie" },
                { id: "tt2395427", title: "Avengers: Age of Ultron", img: "avengers2.JPG", type: "movie" },
                { id: "tt4154756", title: "Avengers: Infinity War", img: "avengers3.JPG", type: "movie" },
                { id: "tt4154796", title: "Avengers: Endgame", img: "avengers4.JPG", type: "movie" }
             ],
            transporter: [
                { id: "tt0293662", title: "The Transporter - (2002) ", img: "trans1.JPG", type: "movie" },
                { id: "tt0388482", title: "(Transporter 2 - 2005)", img: "trans2.JPG", type: "movie" },
                { id: "tt1129442", title: "(Transporter 3 - 2008)", img: "trans3.JPG", type: "movie" },
                { id: "tt2938956", title: "(The Transporter Refueled - 2015)", img: "trans4.JPG", type: "movie" }
            ],
            fast: [
                { id: "tt0232500", title: "Fast & Furious 1", img: "fast1.JPG", type: "movie" },
                { id: "tt0322259", title: "2 Fast 2 Furious", img: "fast2.JPG", type: "movie" },
                { id: "tt0463364", title: "Tokyo Drift", img: "fast3.JPG", type: "movie" },
                { id: "tt1013752", title: "Fast & Furious 4", img: "fast4.JPG", type: "movie" },
                { id: "tt1596343", title: "Fast Five", img: "fast5.JPG", type: "movie" },
                { id: "tt1905041", title: "Fast 6", img: "fast6.JPG", type: "movie" },
                { id: "tt2820852", title: "Furious 7", img: "fast7.JPG", type: "movie" },
                { id: "tt3882058", title: "The Fate of the Furious", img: "fast8.JPG", type: "movie" },
                { id: "tt5433138", title: "F9: The Fast Saga", img: "fast9.JPG", type: "movie" },
                { id: "tt15327088", title: "Fast X", img: "fast10.JPG", type: "movie" },
                { id: "tt6806448", title: "Fast & Furious Presents: Hobbs & Shaw", img: "fast11.JPG", type: "movie" }
            ],
            action: [
                { id: "tt0068646", title: "The Godfather Part I", img: "godfather.JPG", type: "movie" },
                { id: "tt0071562", title: "The Godfather Part II", img: "godfather2.JPG", type: "movie" },
                { id: "tt0099685", title: "Goodfellas", img: "goodfellas.JPG", type: "movie" },
                { id: "tt0086250", title: "Scarface", img: "scarface.JPG", type: "movie" },
                { id: "tt2403776", title: "John Wick", img: "johnwick.JPG", type: "movie" },
                { id: "tt0468569", title: "The Dark Knight", img: "darkknight.JPG", type: "movie" },
                { id: "tt0133093", title: "The Matrix", img: "matrix.JPG", type: "movie" },
                { id: "tt0816692", title: "Interstellar", img: "interstellar.JPG", type: "movie" },
                { id: "tt0172495", title: "Gladiator", img: "gladiator.JPG", type: "movie" },
                { id: "tt9316984", title: "Fractured", img: "fractured.JPG", type: "movie" },
            ],
            actioncomedy: [      
                { id: "tt0112442", title: "Bad Boys", img: "badboys.JPG", type: "movie" },
                { id: "tt0172156", title: "Bad Boys II", img: "badboys2.JPG", type: "movie" },
                { id: "tt7991608", title: "Red Notice", img: "rednot.JPG", type: "movie" },
                { id: "tt2463208", title: "The Adam Project", img: "adam.JPG", type: "movie" },
                { id: "tt2283362", title: "Jumanji: Welcome to the Jungle", img: "jumanji.JPG", type: "movie" },
                { id: "tt7975244", title: "Jumanji: The Next Level", img: "level.JPG", type: "movie" },
                { id: "tt26735127", title: "Jumanji3", img: "jumanji3.heic", type: "movie" },
                { id: "tt1489889", title: "Central Intelligence", img: "central.JPG", type: "movie" },
                { id: "tt1469304", title: "Baywatch", img: "baywatch.JPG", type: "movie" },
                { id: "tt8106534", title: "6 Underground", img: "under.JPG", type: "movie" },
                { id: "tt6264654", title: "Free Guy", img: "free.JPG", type: "movie" },
                { id: "tt1464335", title: "Uncharted", img: "uncharted.JPG", type: "movie" },
                { id: "tt1649418", title: "The Gray Man", img: "gray.JPG", type: "movie" },
                { id: "tt1408253", title: "Ride Along", img: "ride.JPG", type: "movie" },
                { id: "tt2231461", title: "Rampage", img: "rampage.JPG", type: "movie" },
                { id: "tt1375670", title: "Grown Ups", img: "grown.JPG", type: "movie" },
                { id: "tt1637725", title: "Ted", img: "Ted.JPG", type: "movie" },
                { id: "tt2637276", title: "Ted 2", img: "Ted2.JPG", type: "movie" },
                { id: "tt0870154", title: "Jungle Cruise", img: "Jungle.JPG", type: "movie" },
                { id: "tt0369610", title: "Jurassic World", img: "World.JPG", type: "movie" },
                { id: "tt0116126", title: "Don't Be a Menace to South Central While Drinking Your Juice in the Hood", img: "dont.JPG", type: "movie" },
                { id: "tt0465494", title: "Hitman", img: "hitman.JPG", type: "movie" },
                { id: "tt2679042", title: "Hitman Agent 47", img: "hitman2.JPG", type: "movie" }
            ],
            horror: [
                { id: "tt0387564", title: "Saw 1", img: "saw1.JPG", type: "movie" },
                { id: "tt0432348", title: "Saw 2", img: "saw2.JPG", type: "movie" },
                { id: "tt0489270", title: "Saw 3", img: "saw3.JPG", type: "movie" },
                { id: "tt0890870", title: "Saw 4", img: "saw4.JPG", type: "movie" },
                { id: "tt1132626", title: "Saw 5", img: "saw5.JPG", type: "movie" },
                { id: "tt1233227", title: "Saw 6", img: "saw6.JPG", type: "movie" },
                { id: "tt1477076", title: "Saw 3D", img: "saw7.JPG", type: "movie" },
                { id: "tt3348730", title: "Jigsaw (Saw 8)", img: "saw8.JPG", type: "movie" },
                { id: "tt0117588", title: "Scream 1", img: "scream1.JPG", type: "movie" },
                { id: "tt0120082", title: "Scream 2", img: "scream2.JPG", type: "movie" },
                { id: "tt0134084", title: "Scream 3", img: "scream3.JPG", type: "movie" },
                { id: "tt1262416", title: "Scream 4", img: "scream4.JPG", type: "movie" },
                { id: "tt11245972", title: "Scream 5", img: "scream5.JPG", type: "movie" },
                { id: "tt20872390", title: "Scream 6", img: "scream6.JPG", type: "movie" },
                { id: "tt27047903", title: "Scream 7", img: "scream7.JPG", type: "movie" },
                { id: "tt1457767", title: "The Conjuring 1", img: "conjuring1.JPG", type: "movie" },
                { id: "tt3065204", title: "The Conjuring 2", img: "conjuring2.jpeg", type: "movie" },
                { id: "tt7069210", title: "The Conjuring 3", img: "conjuring3.JPG", type: "movie" },
                { id: "tt15474916", title: "Smile", img: "smile.JPG", type: "movie" },
                { id: "tt29268110", title: "Smile 2", img: "smile2.JPG", type: "movie" },
                { id: "tt5814060", title: "The Nun", img: "nun1.JPG", type: "movie" },
                { id: "tt10160976", title: "The Nun 2", img: "nun2.JPG", type: "movie" },
                { id: "tt1591095", title: "Insidious: Chapter 1", img: "insidious1.JPG", type: "movie" },
                { id: "tt2226417", title: "Insidious: Chapter 2", img: "insidious2.JPG", type: "movie" },
                { id: "tt3195644", title: "Insidious: Chapter 3", img: "insidious3.JPG", type: "movie" },
                { id: "tt13405778", title: "Insidious: The Red Door", img: "insidious5.JPG", type: "movie" },
                { id: "tt1396484", title: "It (2017)", img: "it1.JPG", type: "movie" },
                { id: "tt7349950", title: "It: Chapter Two", img: "it2.JPG", type: "movie" }
            ],
            thriller: [
                { id: "tt1051906", title: "The Invisible Man (2020)", img: "invisible.JPG", type: "movie" },
                { id: "tt9764362", title: "The Menu (2022)", img: "menu.JPG", type: "movie" },
                { id: "tt12747748", title: "Leave the World Behind (2023)", img: "leave-world.JPG", type: "movie" },
                { id: "tt9639470", title: "Last Night in Soho (2021)", img: "soho.JPG", type: "movie" },
                { id: "tt11564570", title: "Glass Onion (2022)", img: "glass-onion.JPG", type: "movie" },
                { id: "tt8740790", title: "Missing (2023)", img: "missing.JPG", type: "movie" },
                { id: "tt26753003", title: "Trap (2024)", img: "trap.JPG", type: "movie" },
                { id: "tt7657566", title: "Death on the Nile (2022)", img: "nile.JPG", type: "movie" },
                { id: "tt14138650", title: "The Pale Blue Eye (2022)", img: "blue-eye.JPG", type: "movie" },
                { id: "tt11301886", title: "Rebel Ridge (2024)", img: "rebel.JPG", type: "movie" }
            ],
            egyptComedy: [
                { id: "tt10228372", title: "الواد سيد الشحات", img: "sayed-shahat.JPG", type: "series", seasons: 1, episodes: 30 },
                { id: "tt21064402", title: "اللعبة", img: "el-leba.JPG", type: "series", seasons: 4, episodes: 30 },
                { id: "tt14460770", title: "موضوع عائلي", img: "mawdoo-family.JPG", type: "series", seasons: 2, episodes: 12 },
                { id: "tt14587422", title: "أشغال شقة", img: "ashghal-shaqa.JPG", type: "series", seasons: 1, episodes: 15 }
            ],
            foreignSeries: [
                { id: "tt0903747", title: "Breaking Bad", img: "breaking-bad.JPG", type: "series", seasons: 5, episodes: 13 },
                { id: "tt0944947", title: "Game of Thrones", img: "got.JPG", type: "series", seasons: 8, episodes: 10 },
                { id: "tt11198330", title: "The Last of Us", img: "last-of-us.JPG", type: "series", seasons: 1, episodes: 9 }
            ]
        };

        const apis = [
            { name: "سيرفر 1", movie: "https://vidsrc.me/embed/movie?imdb=", tv: "https://vidsrc.me/embed/tv?imdb=" },
            { name: "سيرفر 2", movie: "https://vidsrc.to/embed/movie/", tv: "https://vidsrc.to/embed/tv/" },
            { name: "سيرفر 3", movie: "https://autoembed.to/movie/imdb/", tv: "https://autoembed.to/tv/imdb/" }
        ];

        let activeMedia = null;
        let currentS = 1;
        let currentE = 1;
        let currentServerIdx = 0;

        window.addEventListener('scroll', () => {
            const header = document.getElementById('mainNav');
            if (header && window.scrollY > 100) header.classList.add('scrolled');
            else if(header) header.classList.remove('scrolled');
        });

        function initApp() {
            renderRow('row-marvel', movieData.marvel);
            renderRow('row-avengers', movieData.avengers);
            renderRow('row-thetransporter', movieData.transporter);
            renderRow('row-fast', movieData.fast);
            renderRow('row-action', movieData.action);
            renderRow('row-actioncomedy', movieData.actioncomedy);
            renderRow('row-horror', movieData.horror);
            renderRow('row-thriller', movieData.thriller);
            renderRow('row-egypt-comedy', movieData.egyptComedy);
            renderRow('row-foreign-series', movieData.foreignSeries);
            checkAuthStatus();
        }

        function showDMCA() {
            document.getElementById('mainPageBody').style.display = 'none';
            document.getElementById('dmcaSection').style.display = 'block';
        }

        function checkAuthStatus() {
            const btn = document.getElementById('mainAuthBtn');
            if (currentUser) {
                btn.innerText = "حسابي";
                btn.onclick = openAccount;
            } else {
                btn.innerText = "دخول";
                btn.onclick = () => toggleModal(true);
            }
        }

        function renderRow(containerId, movies) {
            const container = document.getElementById(containerId);
            if(!container || !movies) return;
            container.innerHTML = ""; 
            movies.forEach(m => {
                const card = createCard(m);
                container.appendChild(card);
            });
        }

        function createCard(m) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            const isFav = favorites.some(f => f.id === m.id);
            
            const iconHTML = currentUser 
                ? `<i class="fas fa-play-circle"></i><span>${m.title}</span>` 
                : `<i class="fas fa-lock"></i><span>مغلق - سجل دخول</span>`;

            const favBtnHTML = currentUser 
                ? `<div class="fav-btn-card ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite('${m.id}')">
                    <i class="fa${isFav ? 's' : 'r'} fa-heart"></i>
                   </div>` 
                : '';

            card.innerHTML = `
                ${favBtnHTML}
                <img src="${m.img}" alt="${m.title}">
                <div class="card-overlay">${iconHTML}</div>
            `;
            card.onclick = () => playMedia(m);
            return card;
        }

        function toggleFavorite(id) {
            if (!currentUser) return toggleModal(true);
            const allItems = Object.values(movieData).flat();
            const item = allItems.find(m => m.id === id);
            const index = favorites.findIndex(f => f.id === id);
            if (index > -1) favorites.splice(index, 1);
            else favorites.push(item);
            localStorage.setItem('sb_favorites', JSON.stringify(favorites));
            initApp();
            if (activeMedia && activeMedia.id === id) updatePlayerFavBtn();
            if (document.getElementById('accountSection').style.display === 'block') renderFavorites();
        }

        function updatePlayerFavBtn() {
            const btn = document.getElementById('playerFavBtn');
            const isFav = favorites.some(f => f.id === activeMedia.id);
            if (isFav) {
                btn.classList.add('active');
                btn.innerHTML = `<i class="fas fa-check"></i> في قائمتي`;
            } else {
                btn.classList.remove('active');
                btn.innerHTML = `<i class="fas fa-plus"></i> إضافة لقائمتي`;
            }
        }

        function toggleFavoriteFromPlayer() { if (activeMedia) toggleFavorite(activeMedia.id); }

        function renderFavorites() {
            const grid = document.getElementById('favoritesGrid');
            const stat = document.getElementById('favStats');
            stat.innerText = favorites.length;
            if (favorites.length === 0) {
                grid.innerHTML = `<p style="color: #666; font-size: 14px; width:100%; text-align:center;">لا يوجد أفلام في قائمتك بعد.</p>`;
                return;
            }
            grid.innerHTML = "";
            favorites.forEach(m => grid.appendChild(createCard(m)));
        }

        function playMedia(item) {
            if (!currentUser) {
                alert("يجب عليك تسجيل الدخول أولاً لفتح القفل ومشاهدة المحتوى!");
                toggleModal(true);
                return;
            }
            activeMedia = item;
            currentS = 1; currentE = 1; currentServerIdx = 0;
            watchCount++;
            localStorage.setItem('sb_watch_count', watchCount);
            document.getElementById('movieTitleDisplay').innerText = item.title;
            updatePlayerFavBtn();
            const seriesControls = document.getElementById('seriesControls');
            if (item.type === "series") { seriesControls.style.display = "block"; renderSeriesUI(); }
            else { seriesControls.style.display = "none"; }
            updatePlayer();
            document.getElementById('videoPopup').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function renderSeriesUI() {
            const sContainer = document.getElementById('seasonContainer');
            const eContainer = document.getElementById('episodeContainer');
            sContainer.innerHTML = "";
            for (let i = 1; i <= activeMedia.seasons; i++) {
                const btn = document.createElement('button');
                btn.className = "ep-btn" + (i === currentS ? " active" : "");
                btn.innerText = "الموسم " + i;
                btn.onclick = () => { currentS = i; currentE = 1; renderSeriesUI(); updatePlayer(); };
                sContainer.appendChild(btn);
            }
            eContainer.innerHTML = "";
            for (let j = 1; j <= activeMedia.episodes; j++) {
                const btn = document.createElement('button');
                btn.className = "ep-btn" + (j === currentE ? " active" : "");
                btn.innerText = "الحلقة " + j;
                btn.onclick = () => { currentE = j; renderSeriesUI(); updatePlayer(); };
                eContainer.appendChild(btn);
            }
        }

        function updatePlayer() {
            const player = document.getElementById('mainPlayer');
            const serverList = document.getElementById('serverList');
            serverList.innerHTML = "";
            apis.forEach((api, index) => {
                const btn = document.createElement('button');
                btn.className = "server-btn" + (index === currentServerIdx ? " active" : "");
                btn.innerText = api.name;
                btn.onclick = () => { currentServerIdx = index; updatePlayer(); };
                serverList.appendChild(btn);
            });
            let finalUrl = "";
            const api = apis[currentServerIdx];
            if (activeMedia.type === "movie") finalUrl = api.movie + activeMedia.id;
            else finalUrl = (currentServerIdx === 0) ? api.tv + activeMedia.id + `&sea=${currentS}&epi=${currentE}` : api.tv + activeMedia.id + `/${currentS}/${currentE}`;
            player.src = finalUrl;
        }

        function closePlayer() {
            document.getElementById('mainPlayer').src = "";
            document.getElementById('videoPopup').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            if (email === "mustafabarbour5@gmail.com" && pass === "Abd120120") {
                currentUser = { name: "Mostafa Barbour", email: email, isOwner: true };
            } else {
                currentUser = { name: "User_" + Math.floor(Math.random() * 9000), email: email, isOwner: false };
            }
            localStorage.setItem('sb_user', JSON.stringify(currentUser));
            location.reload();
        }

        function handleRegister() {
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const confirm = document.getElementById('regPassConfirm').value;
            const botCheck = document.querySelector('input[name="bot_check"]').value;

            if(botCheck !== "") return;
            if (pass !== confirm) {
                alert("كلمات المرور غير متطابقة!");
                resetBtn();
                return;
            }

            currentOTP = Math.floor(10000 + Math.random() * 90000).toString();
            tempRegData = { email: email };
            
            document.getElementById('registerBox').style.display = 'none';
            document.getElementById('verifyBox').style.display = 'block';
            alert("كود التحقق الخاص بك هو: " + currentOTP);
        }

        function handleVerification(e) {
            e.preventDefault();
            if (document.getElementById('verifyInput').value === currentOTP) {
                currentUser = { name: "عضو جديد", email: tempRegData.email, isOwner: false };
                localStorage.setItem('sb_user', JSON.stringify(currentUser));
                location.reload();
            } else { alert("الكود خطأ!"); }
        }

        function resetBtn() {
            document.getElementById('regBtnText').style.display = 'block';
            document.getElementById('regLoader').style.display = 'none';
        }

        function toggleModal(show) {
            document.getElementById('authModal').style.display = show ? 'flex' : 'none';
            if(show) switchAuthMode('login');
        }

        function switchAuthMode(mode) {
            document.getElementById('loginBox').style.display = mode === 'login' ? 'block' : 'none';
            document.getElementById('registerBox').style.display = mode === 'register' ? 'block' : 'none';
            document.getElementById('verifyBox').style.display = 'none';
            resetBtn();
        }

        function handleSearch(e) {
            e.preventDefault();
            const query = document.getElementById('globalSearch').value.toLowerCase();
            const resultsGrid = document.getElementById('searchResultsGrid');
            resultsGrid.innerHTML = "";
            const allItems = Object.values(movieData).flat();
            const filtered = allItems.filter(item => item.title.toLowerCase().includes(query));
            filtered.forEach(item => resultsGrid.appendChild(createCard(item)));
            document.getElementById('mainPageBody').style.display = 'none';
            document.getElementById('searchOverlay').style.display = 'block';
        }

        function closeSearch() {
            document.getElementById('searchOverlay').style.display = 'none';
            document.getElementById('mainPageBody').style.display = 'block';
        }

        function openAccount() {
            document.getElementById('mainPageBody').style.display = 'none';
            document.getElementById('accountSection').style.display = 'block';
            document.getElementById('accDisplayName').innerHTML = currentUser.name + (currentUser.isOwner ? ' <i class="fas fa-check-circle verified-badge"></i>' : '');
            document.getElementById('watchStats').innerText = watchCount;
            renderFavorites();
        }

        function closeAccount() {
            document.getElementById('accountSection').style.display = 'none';
            document.getElementById('mainPageBody').style.display = 'block';
        }

        function updateUsername() {
            const newName = document.getElementById('editNameInput').value;
            if(newName.trim() !== "") {
                currentUser.name = newName;
                localStorage.setItem('sb_user', JSON.stringify(currentUser));
                openAccount();
                alert("تم تحديث الاسم!");
            }
        }

        function logoutUser() { localStorage.removeItem('sb_user'); location.reload(); }
        function submitFeedback() { alert("تم إرسال تقييمك بنجاح!"); document.getElementById('feedbackMsg').value = ""; }

        initApp();
    </script>
</body>
</html>
